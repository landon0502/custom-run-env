# 银响力 OEM Plugin for HBuilderx 说明（Custom Run Env）

主要解决多厂商OEM打包配置时需手动调整代码，这时得每次都需要去校验配置的正确性，且手动改代码费力费时，这里通过插件统一规范OEM配置及资源，一键生成对应配置、替换对应资源，简化OEM打包配置过程。

## 一、快速使用

- 在开始之前需要再Hbuilderx中安装对应插件[下载地址](https://ext.dcloud.net.cn/plugin?name=customrunenv-tool)并在项目根目录下创建.run_env目录，安装完成以后再对应项目右键菜单会新增OEM菜单组，包含四个功能：生成配置文件、新建、编辑、启动监听。
- 生成配置文件：点击后生成对应OEM配置及manifest.json，生成目录根据项目创建的方式而定，@vue/cli创建的在src下，hbuilderx创建的在项目跟根目录下。
- 新建：点击弹出表单视图，根据表单提示填写配置后会在OEM管理目录.run_env下创建一个新的OEM目录，打开该OEM配置可见存在manifest.json和config.json及assets文件目录。
- 编辑：点击弹出表单视图，并解析当OEM配置信息，修改完成后点击确认后会重新写入OEM配置中，如果修改了OEM名称，那么会生成一个新的OEM，并删除旧的数据。
- 启动监听：主要作用是监听OEM配置的修改动态生成配置，在调试时比较有用。
- 初始化配置目录：根据.run_env目录配置项自动创建配置目录。

<font style="color: green">注意：当前插件配置默认都以银响力app当前环境进行了配置，基本都无需调整配置</font>

## 二、配置说明

### 插件配置Settings->插件配置->customrunenv-tool

<font style="color: red">注意：【预设配置】为当前插件版本暂时未使用，后期会逐步完善</font>

| 配置项                                  | 类型        | 说明                                                         |
| --------------------------------------- | ----------- | ------------------------------------------------------------ |
| 【预设配置】指定hbuilder cli名，默认cli | string      | 指定Hbuilderx终端命令名称，Hbuilderx在安装时默认是cli作为默认指令名称，可自行在环境变量中配置<br> |
| 配置可选择的原生插件(JSON)              | Json-string | 用于原生插件选项及配置，默认不用配置，预置了当前银响力所需的原生插件；如果需要更新配置，需先在Hbuilderx 项目中manifest.json中配置完成所有原生插件配置，需要在源码视图中将nativePlugins值转换为json字符串填写于此。 |
| 指定manifest配置输出路径                | string      | 指定manifest.json最终输出路径                                |
| 图片资源目录，相对于”加载目录“设置      | string      | 插件解析配置资源时的路径，如各类logo、启动页，需要相对于当前解析环境进行配置，例：为“千行猫”这个OEM配置assets资源目录，那么路径应为`千行猫/assets`，配置就需填写assets |
| 指定oem-config配置输出路径              | string      | 指定oem-config.json配置文件输出路径                          |
| 指定插件加载目录                        | string      | 插件加载OEM列表更目录，默认从当前项目的.run_env中加载        |



## 三、如何添加一个OEM配置

1、在对应项目中右键打开菜单，在OEM中选择“新建”选项，会出现以下表单窗口。

其中已存在的值都为OEM默认值，如果没有提供对应配置，则不需要进行调整，在配置完成所有配置项时，点击确认就会在指定的加载目录创建一个与OEM应用名同名文件目录，默认加载目录为项目根目录的`.run_env`。

### 1、新建OEM配置说明

| 配置项                  | 说明                                                       | 是否必填                                                     | 默认值 |
| ----------------------- | ---------------------------------------------------------- | ------------------------------------------------------------ | ------ |
| 应用名称                | oem应用名称                                                | 是                                                           |        |
| Uniapp APPID            | hbuilderx创建应用的appid                                   | 是                                                           |        |
| 安卓包名                | 用于打包及插件绑定                                         | 是，除了【i收银以外，oem基本上都是android】                  |        |
| ios包名                 | 用于打包及插件绑定                                         | 否                                                           |        |
| 服务商编号OEM CODE      | 服务商编号                                                 | 是                                                           |        |
| 应用推送升级标识upgrade | 在推升级时需要                                             | 否，如何没有填写则会自动生成，规则：app名称首拼+appid_后部分 |        |
| 支付协议                | 创建商品时的支付协议，如配置为空，则支付协议不显示         | 否                                                           |        |
| logo                    | App logo 及 app 选择店铺、创建店铺使用                     | 是                                                           |        |
| 登录logo                | 登录页面顶部使用的logo                                     | 是                                                           |        |
| 中仑应用                | 是否是中仑 1-是 0-否                                       | 是                                                           | 否     |
| 是否是OEM应用           | 该应用是否是OEM应用，这个在代码内部，OEM应用只有零售       | 是                                                           | 是     |
| 中兴应用                | 是否为中兴app，目前主要针对i收银                           | 是                                                           | 否     |
| 登录主题                | 单独用来判断登录页的主题色                                 | 是                                                           | 中仑   |
| 选择商铺类型            | 设置商铺支持的类型，类型有零售、生鲜通、轻餐宝、茶舍、食神 | 是                                                           |        |
| 配置oem manifest        | 应用manifest配置                                           | 是                                                           |        |

### 2、选择商品

选择需要的商品类型，该配置作用于店铺选择页面头部tabs，和创建店铺页面店铺类型卡片选择。如果在下面配置了LOGO并且选择了该类型，则两个页面对应的LOGO会替换，如果不配置，OEM零售店铺下会默认替换成App的logo，其他则不影响。

### 3、OEM manifest.json配置

| 配置项                          | 说明                                      |
| ------------------------------- | ----------------------------------------- |
| 隐私协议                        | 用于应用启动时协议确认框（隐私协议）      |
| 用户协议                        | 用于应用启动时协议确认框（用户协议）      |
| ios启动图                       | ios应用启动图【注意：只支持storyboard包】 |
| android hdpi \| xhdpi \| xxhdpi | android应用启动图【注意：图片为*.9.png】  |
| 高德地图（android \| iOS） key  | 高德地图key                               |

#### （1）原生插件

在Manifest配置窗口点击“选择原生插件”按钮，选择当前oem需要的插件，如果是新建的OEM应用，云打包插件需要先去uniapp插件市场进行购买才能使用。选择的插件如果需要配置key，点击确定后，会出现对应的配置项。

